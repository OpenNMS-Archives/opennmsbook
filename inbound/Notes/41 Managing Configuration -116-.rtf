{\rtf1\ansi\ansicpg1252\cocoartf1038\cocoasubrtf350
\stshfdbch0{\fonttbl\f0\froman\fcharset0 Times-Roman;\f1\fnil\fcharset0 LucidaGrande;\f2\fmodern\fcharset0 Courier;
}
{\colortbl;\red255\green255\blue255;\red4\green0\blue240;}
{\stylesheet {\s0 Normal;}}
{\*\listtable{\list\listtemplateid1\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid1\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{circle\}}{\leveltext\leveltemplateid2\'01\uc0\u9702 ;}{\levelnumbers;}\fi-360\li1440\lin1440 }{\listname ;}\listid1}}
{\*\listoverridetable{\listoverride\listid1\listoverridecount0\ls1}}
{\info
{\author Alexander Finger}
{\creatim\yr2011\mo6\dy21\hr17\min19\sec29\timesinceref330387569}
{\revtim\yr2011\mo6\dy21\hr17\min19\sec53\timesinceref330387593}}\deftab720
\pard\pardeftab720\sa240\ql\qnatural

\f0\fs24 \cf0 OpenNMS's configuration is very powerful, but with that unfortunately comes a level of complexity that can make it difficult to manage upgrades. One of the easiest ways to mitigate this is by using git to manage your configuration upgrades.\

\itap1\trowd \taflags0 \trgaph108\trleft-108 \trbrdrt\brdrnil \trbrdrl\brdrnil \trbrdrt\brdrnil \trbrdrr\brdrnil 
\clvertalc \clshdrawnil \clwWidth5680\clftsWidth3 \clmart10 \clmarl10 \clmarb10 \clmarr10 \clbrdrt\brdrnil \clbrdrl\brdrnil \clbrdrb\brdrnil \clbrdrr\brdrnil \clpadt20 \clpadl20 \clpadb20 \clpadr20 \gaph\cellx8640
\pard\intbl\itap1\pardeftab720\sa280\ql\qnatural

\b\fs36 \cf0 Contents\
\pard\intbl\itap1\pardeftab720\ql\qnatural

\b0\fs24 \cf0 [{\field{\*\fldinst{HYPERLINK "javascript:toggleToc()"}}{\fldrslt \cf2 \ul \ulc2 hide}}]\
\pard\intbl\itap1\tx220\tx720\pardeftab720\li720\fi-500\ql\qnatural
\ls1\ilvl0\cf2 {\listtext	\'95	}{\field{\*\fldinst{HYPERLINK "http://www.opennms.org/wiki/Managing_Configuration_Changes_with_Git#Getting_Started"}}{\fldrslt 1\ul  \ulnone Getting Started}}\cf0 \
\pard\intbl\itap1\tx940\tx1440\pardeftab720\li1440\fi-500\ql\qnatural
\ls1\ilvl1\cf2 {\listtext	
\f1 \uc0\u9702 
\f0 	}{\field{\*\fldinst{HYPERLINK "http://www.opennms.org/wiki/Managing_Configuration_Changes_with_Git#Start_with_a_Pristine_etc_Directory"}}{\fldrslt 1.1\ul  \ulnone Start with a Pristine etc Directory}}\cf0 \
\ls1\ilvl1\cf2 {\listtext	
\f1 \uc0\u9702 
\f0 	}{\field{\*\fldinst{HYPERLINK "http://www.opennms.org/wiki/Managing_Configuration_Changes_with_Git#Initialize_Git"}}{\fldrslt 1.2\ul  \ulnone Initialize Git}}\cf0 \
\ls1\ilvl1\cf2 {\listtext	
\f1 \uc0\u9702 
\f0 	}{\field{\*\fldinst{HYPERLINK "http://www.opennms.org/wiki/Managing_Configuration_Changes_with_Git#Create_Your_Branch"}}{\fldrslt 1.3\ul  \ulnone Create Your Branch}}\cf0 \
\ls1\ilvl1\cf2 {\listtext	
\f1 \uc0\u9702 
\f0 	}{\field{\*\fldinst{HYPERLINK "http://www.opennms.org/wiki/Managing_Configuration_Changes_with_Git#Make_Your_Changes"}}{\fldrslt 1.4\ul  \ulnone Make Your Changes}}\cf0 \
\pard\intbl\itap1\tx220\tx720\pardeftab720\li720\fi-500\ql\qnatural
\ls1\ilvl0\cf2 {\listtext	\'95	}{\field{\*\fldinst{HYPERLINK "http://www.opennms.org/wiki/Managing_Configuration_Changes_with_Git#Doing_an_Upgrade"}}{\fldrslt 2\ul  \ulnone Doing an Upgrade}}\cf0 \
\pard\intbl\itap1\tx940\tx1440\pardeftab720\li1440\fi-500\ql\qnatural
\ls1\ilvl1\cf2 {\listtext	
\f1 \uc0\u9702 
\f0 	}{\field{\*\fldinst{HYPERLINK "http://www.opennms.org/wiki/Managing_Configuration_Changes_with_Git#Stop_OpenNMS"}}{\fldrslt 2.1\ul  \ulnone Stop OpenNMS}}\cf0 \
\ls1\ilvl1\cf2 {\listtext	
\f1 \uc0\u9702 
\f0 	}{\field{\*\fldinst{HYPERLINK "http://www.opennms.org/wiki/Managing_Configuration_Changes_with_Git#Make_Sure_All_Changes_are_Committed"}}{\fldrslt 2.2\ul  \ulnone Make Sure All Changes are Committed}}\cf0 \
\ls1\ilvl1\cf2 {\listtext	
\f1 \uc0\u9702 
\f0 	}{\field{\*\fldinst{HYPERLINK "http://www.opennms.org/wiki/Managing_Configuration_Changes_with_Git#Switch_to_the_Pristine_Branch"}}{\fldrslt 2.3\ul  \ulnone Switch to the Pristine Branch}}\cf0 \
\ls1\ilvl1\cf2 {\listtext	
\f1 \uc0\u9702 
\f0 	}{\field{\*\fldinst{HYPERLINK "http://www.opennms.org/wiki/Managing_Configuration_Changes_with_Git#Upgrade_OpenNMS"}}{\fldrslt 2.4\ul  \ulnone Upgrade OpenNMS}}\cf0 \
\ls1\ilvl1\cf2 {\listtext	
\f1 \uc0\u9702 
\f0 	}{\field{\*\fldinst{HYPERLINK "http://www.opennms.org/wiki/Managing_Configuration_Changes_with_Git#Switch_to_Your_Modified_Branch"}}{\fldrslt 2.5\ul  \ulnone Switch to Your Modified Branch}}\cf0 \
\ls1\ilvl1\cf2 {\listtext	
\f1 \uc0\u9702 
\f0 	}{\field{\*\fldinst{HYPERLINK "http://www.opennms.org/wiki/Managing_Configuration_Changes_with_Git#Apply_Changes_from_Master"}}{\fldrslt 2.6\ul  \ulnone Apply Changes from Master}}\cf0 \
\ls1\ilvl1\cf2 {\listtext	
\f1 \uc0\u9702 
\f0 	}{\field{\*\fldinst{HYPERLINK "http://www.opennms.org/wiki/Managing_Configuration_Changes_with_Git#Check_for_Other_Changes"}}{\fldrslt 2.7\ul  \ulnone Check for Other Changes}}\cf0 \
\ls1\ilvl1\cf2 {\listtext	
\f1 \uc0\u9702 
\f0 	}{\field{\*\fldinst{HYPERLINK "http://www.opennms.org/wiki/Managing_Configuration_Changes_with_Git#Start_OpenNMS"}}{\fldrslt 2.8\ul  \ulnone Start OpenNMS}}\cf0 \cell \lastrow\row
\pard\pardeftab720\sa280\ql\qnatural

\b\fs36 \cf0 [{\field{\*\fldinst{HYPERLINK "http://www.opennms.org/w/index.php?title=Managing_Configuration_Changes_with_Git&action=edit&section=1"}}{\fldrslt \cf2 \ul \ulc2 edit}}] Getting Started\
\pard\pardeftab720\sa240\ql\qnatural

\b0\fs24 \cf0 First, if you're not familiar with Git, you may want to read our {\field{\*\fldinst{HYPERLINK "http://www.opennms.org/wiki/Developing_with_Git"}}{\fldrslt \cf2 \ul \ulc2 developing with Git}} page, as well as the {\field{\*\fldinst{HYPERLINK "http://www.kernel.org/pub/software/scm/git/docs/gittutorial.html"}}{\fldrslt \cf2 \ul \ulc2 Git tutorial}}.\
If you have an existing OpenNMS install, the easiest way to get started is to make sure you have a version of OpenNMS which provides the "etc-pristine" directory (in the 1.6.x series, OpenNMS 1.6.9 or higher, and in the 1.7/1.8 series, OpenNMS 1.7.9 or higher).\
If this is your first time installing OpenNMS, you can skip to the {\field{\*\fldinst{HYPERLINK "http://www.opennms.org/wiki/Managing_Configuration_Changes_with_Git#Create_Your_Branch"}}{\fldrslt \cf2 \ul \ulc2 Create Your Branch}} section.\
Don't forget to stop OpenNMS before messing with the etc directory!\
\pard\pardeftab720\sa280\ql\qnatural

\b\fs28 \cf0 [{\field{\*\fldinst{HYPERLINK "http://www.opennms.org/w/index.php?title=Managing_Configuration_Changes_with_Git&action=edit&section=2"}}{\fldrslt \cf2 \ul \ulc2 edit}}] Start with a Pristine etc Directory\
\pard\pardeftab720\sa240\ql\qnatural

\b0\fs24 \cf0 If you have an existing OpenNMS installation, move your existing $OPENNMS_HOME/etc directory out of the way:\
\pard\pardeftab720\ql\qnatural

\f2 \cf0  mv $OPENNMS_HOME/etc $OPENNMS_HOME/etc.bak\
\pard\pardeftab720\sa240\ql\qnatural

\f0 \cf0 Then, copy etc-pristine to $OPENNMS_HOME/etc. On RPM-based installations, this is in $OPENNMS_HOME/share/etc-pristine, on Debian, it's in /usr/share/opennms/etc-pristine.\
\pard\pardeftab720\ql\qnatural

\f2 \cf0  cp -pR $OPENNMS_HOME/share/etc-pristine $OPENNMS_HOME/etc\
\pard\pardeftab720\sa280\ql\qnatural

\f0\b\fs28 \cf0 [{\field{\*\fldinst{HYPERLINK "http://www.opennms.org/w/index.php?title=Managing_Configuration_Changes_with_Git&action=edit&section=3"}}{\fldrslt \cf2 \ul \ulc2 edit}}] Initialize Git\
\pard\pardeftab720\sa240\ql\qnatural

\b0\fs24 \cf0 Next, you'll turn your etc directory into a git repository, and add the pristine files as the first commit.\
\pard\pardeftab720\ql\qnatural

\f2 \cf0  cd $OPENNMS_HOME/etc\
 git init \
 git add .\
 git commit -m "Initial checkin of OpenNMS x.x.x configuration."\
\pard\pardeftab720\sa280\ql\qnatural

\f0\b\fs28 \cf0 [{\field{\*\fldinst{HYPERLINK "http://www.opennms.org/w/index.php?title=Managing_Configuration_Changes_with_Git&action=edit&section=4"}}{\fldrslt \cf2 \ul \ulc2 edit}}] Create Your Branch\
\pard\pardeftab720\sa240\ql\qnatural

\b0\fs24 \cf0 Finally, you'll create your branch to make local modifications. This way, whenever it's time to upgrade, you can put your git repo back in "pristine" mode to catch changes since the last version.\
\pard\pardeftab720\ql\qnatural

\f2 \cf0  cd $OPENNMS_HOME/etc\
 git branch local-modifications\
 git checkout local-modifications\
\pard\pardeftab720\sa280\ql\qnatural

\f0\b\fs28 \cf0 [{\field{\*\fldinst{HYPERLINK "http://www.opennms.org/w/index.php?title=Managing_Configuration_Changes_with_Git&action=edit&section=5"}}{\fldrslt \cf2 \ul \ulc2 edit}}] Make Your Changes\
\pard\pardeftab720\sa240\ql\qnatural

\b0\fs24 \cf0 Now, just edit your configuration normally, and you're all set. If you have an existing config that was backed up, you can just run:\
\pard\pardeftab720\ql\qnatural

\f2 \cf0  rsync -avr $OPENNMS_HOME/etc.bak/ $OPENNMS_HOME/etc/\
\pard\pardeftab720\sa240\ql\qnatural

\f0 \cf0 Whenever you're done making changes to your etc directory, add and commit them, like so:\
\pard\pardeftab720\ql\qnatural

\f2 \cf0  cd $OPENNMS_HOME/etc\
 git add .\
 git commit -m "Added initial discovery ranges."\
\pard\pardeftab720\sa240\ql\qnatural

\f0 \cf0 Now you can start OpenNMS back up again.\
\pard\pardeftab720\sa280\ql\qnatural

\b\fs36 \cf0 [{\field{\*\fldinst{HYPERLINK "http://www.opennms.org/w/index.php?title=Managing_Configuration_Changes_with_Git&action=edit&section=6"}}{\fldrslt \cf2 \ul \ulc2 edit}}] Doing an Upgrade\
\pard\pardeftab720\sa240\ql\qnatural

\b0\fs24 \cf0 Now that you've got your etc directory managed by Git, it should be much easier to perform an upgrade. You just need to switch back to the pristine copy, upgrade, switch back, and merge the changes. Git has a very good merge algorithm, and will merge most configuration changes without any need for manual intervention.\
\pard\pardeftab720\sa280\ql\qnatural

\b\fs28 \cf0 [{\field{\*\fldinst{HYPERLINK "http://www.opennms.org/w/index.php?title=Managing_Configuration_Changes_with_Git&action=edit&section=7"}}{\fldrslt \cf2 \ul \ulc2 edit}}] Stop OpenNMS\
\pard\pardeftab720\sa240\ql\qnatural

\b0\fs24 \cf0 Of course, the first step before doing an upgrade is to stop OpenNMS. =)\
\pard\pardeftab720\ql\qnatural

\f2 \cf0  /etc/init.d/opennms stop\
\pard\pardeftab720\sa280\ql\qnatural

\f0\b\fs28 \cf0 [{\field{\*\fldinst{HYPERLINK "http://www.opennms.org/w/index.php?title=Managing_Configuration_Changes_with_Git&action=edit&section=8"}}{\fldrslt \cf2 \ul \ulc2 edit}}] Make Sure All Changes are Committed\
\pard\pardeftab720\sa240\ql\qnatural

\b0\fs24 \cf0 Don't forget that if any files are modified, you'll want to add and commit them before doing the upgrade.\
\pard\pardeftab720\ql\qnatural

\f2 \cf0  git status\
\pard\pardeftab720\sa240\ql\qnatural

\f0 \cf0 If it says there are modifications, follow the instructions in {\field{\*\fldinst{HYPERLINK "http://www.opennms.org/wiki/Managing_Configuration_Changes_with_Git#Make_Your_Changes"}}{\fldrslt \cf2 \ul \ulc2 Make Your Changes}} above.\
\pard\pardeftab720\sa280\ql\qnatural

\b\fs28 \cf0 [{\field{\*\fldinst{HYPERLINK "http://www.opennms.org/w/index.php?title=Managing_Configuration_Changes_with_Git&action=edit&section=9"}}{\fldrslt \cf2 \ul \ulc2 edit}}] Switch to the Pristine Branch\
\pard\pardeftab720\sa240\ql\qnatural

\b0\fs24 \cf0 The next step is to put your $OPENNMS_HOME/etc back to its pristine condition. To do this, all you need to do is check out the "master" branch, which contains the version of files from {\field{\*\fldinst{HYPERLINK "http://www.opennms.org/wiki/Managing_Configuration_Changes_with_Git#Initialize_Git"}}{\fldrslt \cf2 \ul \ulc2 Initialize Git}} above.\
\pard\pardeftab720\ql\qnatural

\f2 \cf0  git checkout master\
\pard\pardeftab720\sa280\ql\qnatural

\f0\b\fs28 \cf0 [{\field{\*\fldinst{HYPERLINK "http://www.opennms.org/w/index.php?title=Managing_Configuration_Changes_with_Git&action=edit&section=10"}}{\fldrslt \cf2 \ul \ulc2 edit}}] Upgrade OpenNMS\
\pard\pardeftab720\sa240\ql\qnatural

\b0\fs24 \cf0 Now, upgrade OpenNMS in the usual manner (yum upgrade opennms, apt-get upgrade opennms, etc.). You should have no conflicts, since the etc files looked exactly like they did in the original package.\
If you now run status:\
\pard\pardeftab720\ql\qnatural

\f2 \cf0  git status\
\pard\pardeftab720\sa240\ql\qnatural

\f0 \cf0 ... you'll see any changes to the default configs since the version of OpenNMS you've installed.\
If any files have been deleted, you'll need to run 'git rm <filename>' to tell git that they're gone.\
\pard\pardeftab720\ql\qnatural

\f2 \cf0  git rm CHANGELOG\
 git rm map.disable\
\pard\pardeftab720\sa240\ql\qnatural

\f0 \cf0 ...and so on.\
Then you'll need to add the new and changed files, and save these changes to the pristine/master branch, by adding and committing them:\
\pard\pardeftab720\ql\qnatural

\f2 \cf0  git add .\
 git commit -m 'Upgraded to OpenNMS x.x.x.'\
\pard\pardeftab720\sa280\ql\qnatural

\f0\b\fs28 \cf0 [{\field{\*\fldinst{HYPERLINK "http://www.opennms.org/w/index.php?title=Managing_Configuration_Changes_with_Git&action=edit&section=11"}}{\fldrslt \cf2 \ul \ulc2 edit}}] Switch to Your Modified Branch\
\pard\pardeftab720\sa240\ql\qnatural

\b0\fs24 \cf0 Now that OpenNMS is upgraded, and Git knows about the changes to the configs since your previous release, it's time to switch back to your modified branch. All you need to do is check it out:\
\pard\pardeftab720\ql\qnatural

\f2 \cf0  git checkout local-modifications\
\pard\pardeftab720\sa280\ql\qnatural

\f0\b\fs28 \cf0 [{\field{\*\fldinst{HYPERLINK "http://www.opennms.org/w/index.php?title=Managing_Configuration_Changes_with_Git&action=edit&section=12"}}{\fldrslt \cf2 \ul \ulc2 edit}}] Apply Changes from Master\
\pard\pardeftab720\sa240\ql\qnatural

\b0\fs24 \cf0 Finally, you need to apply the changes from master to your local branch. To do so, you just need to 'merge' master into the current working branch ("local-modifications") like so:\
\pard\pardeftab720\ql\qnatural

\f2 \cf0  git merge master\
\pard\pardeftab720\sa240\ql\qnatural

\f0 \cf0 If all goes well, you will see that the files that were changed in the master branch were auto-applied to your "local-modifications" working copy.\
If not, you'll see something like this:\
\pard\pardeftab720\ql\qnatural

\f2 \cf0  git merge master\
 Removing CHANGELOG\
 Removing map.disable\
 Auto-merging surveillance-views.xml\
 CONFLICT (content): Merge conflict in surveillance-views.xml\
 Automatic merge failed; fix conflicts and then commit the result.\
\pard\pardeftab720\sa240\ql\qnatural

\f0 \cf0 A 'git status' will reveal the things that need modification with a "both modified":\
\pard\pardeftab720\ql\qnatural

\f2 \cf0  ...\
 # Unmerged paths:\
 #   (use "git reset HEAD <file>..." to unstage)\
 #   (use "git add <file>..." to mark resolution)\
 #\
 #	both modified:      surveillance-views.xml\
\pard\pardeftab720\sa240\ql\qnatural

\f0 \cf0 Git will insert a standard CVS-style conflict marker in each file where there are conflicts between your local changes and the updates. The changes from your branch will be first, and the changes from the pristine copies will be second, like so:\
\
\pard\pardeftab720\ql\qnatural

\f2 \cf0       <rows>\
<<<<<<< HEAD\
        <row-def row="1" label="Monkey Heads" >\
          <category name="Monkey Heads"/>\
        </row-def>\
        <row-def row="2" label="Routers" >\
          <category name="Routers"/>\
        </row-def>\
        <row-def row="3" label="Switches" >\
          <category name="Switches" />\
        </row-def>\
        <row-def row="4" label="Servers" >\
=======\
        <row-def label="Routers" >\
          <category name="Routers"/>\
        </row-def>\
        <row-def label="Switches" >\
          <category name="Switches" />\
        </row-def>\
        <row-def label="Servers" >\
>>>>>>> master\
          <category name="Servers" />\
        </row-def>\
\pard\pardeftab720\sa240\ql\qnatural

\f0 \cf0 ...just edit the files until they look like you'd expect (in this case, the 'row="n"' bits were removed from surveillance-views.xml) and add and commit the changes:\
\pard\pardeftab720\ql\qnatural

\f2 \cf0  git add .\
 git commit\
\pard\pardeftab720\sa280\ql\qnatural

\f0\b\fs28 \cf0 [{\field{\*\fldinst{HYPERLINK "http://www.opennms.org/w/index.php?title=Managing_Configuration_Changes_with_Git&action=edit&section=13"}}{\fldrslt \cf2 \ul \ulc2 edit}}] Check for Other Changes\
\pard\pardeftab720\sa240\ql\qnatural

\b0\fs24 \cf0 If you're curious what changed in the last upgrade (ie, the last change done to the 'master' branch), you can diff master against its previous commit like so:\
\pard\pardeftab720\ql\qnatural

\f2 \cf0  git diff master~1..master\
\pard\pardeftab720\sa240\ql\qnatural

\f0 \cf0 This works no matter which branch you're in at the time.\
\pard\pardeftab720\sa280\ql\qnatural

\b\fs28 \cf0 [{\field{\*\fldinst{HYPERLINK "http://www.opennms.org/w/index.php?title=Managing_Configuration_Changes_with_Git&action=edit&section=14"}}{\fldrslt \cf2 \ul \ulc2 edit}}] Start OpenNMS\
\pard\pardeftab720\sa240\ql\qnatural

\b0\fs24 \cf0 Now that everything's merged, just start OpenNMS back up, and you should be in business!\
}